<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="GSE 544 - F2024">

<title>Midterm Exam - Data intro and examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Midterm_F2024-example_files/libs/clipboard/clipboard.min.js"></script>
<script src="Midterm_F2024-example_files/libs/quarto-html/quarto.js"></script>
<script src="Midterm_F2024-example_files/libs/quarto-html/popper.min.js"></script>
<script src="Midterm_F2024-example_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Midterm_F2024-example_files/libs/quarto-html/anchor.min.js"></script>
<link href="Midterm_F2024-example_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Midterm_F2024-example_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Midterm_F2024-example_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Midterm_F2024-example_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Midterm_F2024-example_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Midterm Exam - Data intro and examples</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>GSE 544 - F2024 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This document is a copy of the Midterm exam from 2023. In that exam, students were asked to write code to answer the questions below. This year, the questions will be the exact same style, but you will be asked to simply write down the steps of your approach and the approximate code you would use.</p>
<p>We will use the same dataset as in this document, so feel free to load and explore the data prior to the exam!</p>
<section id="the-data" class="level3">
<h3 class="anchored" data-anchor-id="the-data">The Data</h3>
<p>The dataset for this exam concerns hiking trails in America’s National Parks system. Data is taken from the <em>AllTrails</em> app, which allows users to input new trails and rate existing ones. You can find documentation on the dataset from its creator <a href="https://www.kaggle.com/planejane/national-park-trails">here</a>.</p>
<p>Variables in the data are:</p>
<ul>
<li><code>trail_id</code>: An ID number for the trail</li>
<li><code>name</code>: Name of the trail</li>
<li><code>area_name</code>: National Park where the trial is located</li>
<li><code>city_name</code>: City where the trail is located</li>
<li><code>state_name</code>: State where the trail is located</li>
<li><code>country_name</code>: Country where the trail is located</li>
<li><code>_geoloc</code>: Latitude and longitude of trail</li>
<li><code>popularity</code>: A score from 0 to 100 of how often the trail is used.</li>
<li><code>length</code>: Distance covered by trail (in meters).</li>
<li><code>elevation_gain</code>: How much uphill is on the trail (in meters).</li>
<li><code>difficulty_rating</code>: Average user rating of trail difficulty</li>
<li><code>route_type</code>: Type of trail (loop, out and back, or point to point)</li>
<li><code>visitor_usage</code>: (Honestly, I’m not sure what this one is.)</li>
<li><code>avg_rating</code>: The average visitor rating of the trail (1 to 5 stars)</li>
<li><code>num_reviews</code>: The total number of reviews on the app for that trail</li>
<li><code>features</code>: Notable elements about the trail</li>
<li><code>activities</code>: Common uses for the trail</li>
<li><code>units</code>: <strong>This variable is a lie!</strong> All the lengths are in meters.</li>
</ul>
</section>
</section>
<section id="part-one-short-answer-70-points" class="level2">
<h2 class="anchored" data-anchor-id="part-one-short-answer-70-points">Part One: Short Answer [70 points]</h2>
<p><em>Estimated time: 30 minutes</em></p>
<p>Answer each of the following using code, and input your answers to the “Part One Quiz” on Canvas.</p>
<section id="question-1.1-10-points" class="level4">
<h4 class="anchored" data-anchor-id="question-1.1-10-points">Question 1.1 [10 points]</h4>
<p>What is the length <strong>in miles</strong> of the fourth longest trail in California?</p>
<p><strong>EXAMPLE FULL CREDIT ANSWER FOR 2024 VERSION OF EXAM</strong></p>
<p>First, I would limit the data to California, using boolean masking, which would look something like</p>
<pre><code>ca = np_trails[np_trails['state'] == "CA"]</code></pre>
<p>Then, I would convert the <code>length</code> variable in the dataset to be in miles instead of kilometers.</p>
<pre><code>ca['length'] = ca['length']*(conversion math)</code></pre>
<p>Last, I would use <code>sortvalues</code> to order my data by the <code>length</code> variable from high to low, and then I would look at the 4th one.</p>
<pre><code>ca.sortvalues('length')[3]</code></pre>
<p><em>Note that in the above example answer, there are small imperfections in the code! If you try running them, they won’t quite work. This is fine and will not lose points, as long as the general idea and major functions are correct.</em></p>
</section>
<section id="question-1.2-10-points" class="level4">
<h4 class="anchored" data-anchor-id="question-1.2-10-points">Question 1.2 [10 points]</h4>
<p>Consider an “easy” trail to be one that has an elevation gain of less than 500 meters, a distance of less than 5 kilometers, and a difficulty rating below 4.</p>
<p>Which California National Park has the highest average rating of its “easy” trails?</p>
</section>
<section id="question-1.3-15-points" class="level4">
<h4 class="anchored" data-anchor-id="question-1.3-15-points">Question 1.3 [15 points]</h4>
<p>How many National Parks contain the word “Land” somewhere in their name? <em>(if the word appears as part of a longer word, like “Candyland”, this counts too)</em></p>
</section>
<section id="question-1.4-15-points" class="level4">
<h4 class="anchored" data-anchor-id="question-1.4-15-points">Question 1.4 [15 points]</h4>
<p>Consider the following plot, made from a dataset called <code>np_trails_new</code>. Although you can see the code that made the plot, you do not see the code that made the <code>np_trails_new</code> object.</p>
<p>Your job in this question is to create the <code>np_trails_new</code> object. You’ll know when you have succeeded, because the code provided will produce the plot.</p>
<p>In Canvas, turn in the values of the first row of the <code>np_trails_new</code> object.</p>
<p><em>(If your dataset has more columns than seem to be available, only include the ones that were absolutely necessary to keep in this analysis.)</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, aes, geom_density, facet_wrap, ggtitle</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>(ggplot(np_trails_new, aes(x<span class="op">=</span><span class="st">"score"</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_density()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> facet_wrap(<span class="st">'~ measure'</span>, scales <span class="op">=</span> <span class="st">'free'</span>) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> ggtitle(<span class="st">"Overall distribution of various trail scores in National parks"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Midterm_F2024-example_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-1.5-20-points" class="level4">
<h4 class="anchored" data-anchor-id="question-1.5-20-points">Question 1.5 [20 points]</h4>
<p>Recreate the plot below, by filling in the blanks in the code on Canvas.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Midterm_F2024-example_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> _______</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine.scales <span class="im">import</span> _______</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>(ggplot(ca_parks, aes(x<span class="op">=</span><span class="st">"_______"</span>, y<span class="op">=</span><span class="st">"_______"</span>, ______ <span class="op">=</span> <span class="st">"________"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> geom_______()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> scale_______() </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> scale________(guide<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> ______(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> <span class="st">""</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> <span class="st">""</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  _____ <span class="op">=</span> <span class="st">"Number of reviews per trail for CA Parks"</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> ______()</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">+</span> theme(________<span class="op">=</span>element_text(rotation<span class="op">=</span>____, hjust<span class="op">=</span><span class="dv">1</span>)) </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-two-programming-80-points" class="level2">
<h2 class="anchored" data-anchor-id="part-two-programming-80-points">Part Two: Programming [80 points]</h2>
<p><em>Estimated time: 1 hour</em></p>
<section id="question-2.1-30-points" class="level4">
<h4 class="anchored" data-anchor-id="question-2.1-30-points">Question 2.1 [30 points]</h4>
<p>Write a functions to help recommend trails to a user. The function will have as its input the dataset and the name of a National Park, and the following optional arguments:</p>
<ul>
<li>A minimum trail elevation gain (in meters)</li>
<li>A maximum trail elevation gain (in meters)</li>
<li>A minimum trail rating</li>
<li>The type of trail</li>
</ul>
<p><em>(Note: “optional” here means that the function can run even if the user doesn’t supply these arguments, not that they are optional for you to include in your function definition.)</em></p>
<p>The function should return all the trails that fit the supplied criteria. You <strong>may</strong> assume that the variable names of any inputted dataset match the <code>np_trails</code> dataset.</p>
<p>Here is some starter code for this function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> recommend_trails(dataset, ____________):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> min_elev <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    min_elev <span class="op">=</span> ______</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">## More of your code here</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ______</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Include the following code to show your function works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>recommend_trails(np_trails, <span class="st">"Haleakala National Park"</span>, min_elev <span class="op">=</span> <span class="dv">1000</span>, min_rating <span class="op">=</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-2.2-30-points" class="level4">
<h4 class="anchored" data-anchor-id="question-2.2-30-points">Question 2.2 [30 points]</h4>
<p>It’s reasonable to think we might also want to search for hikes according to climate. Therefore, we will scrape the average temperatures for each U.S. state from the following website:</p>
<ul>
<li><a href="https://www.extremeweatherwatch.com/us-state-averages">https://www.extremeweatherwatch.com/us-state-averages</a></li>
</ul>
<p>Write a function that takes one optional arguent, <code>month</code>.</p>
<p>The function should scrape the temperature website above for the desired month. If no month is specified then it should scrape the overall average temperatures. The function should return a data frame of the temperatures for the specified month in the names of the temperature columns.</p>
<p>Here is some starter code for this function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scrape_temps(month <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  my_url <span class="op">=</span> <span class="st">"__________"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  response <span class="op">=</span> ___________(my_url)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  soup <span class="op">=</span> BeautifulSoup(_______, <span class="st">"html.parser"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">## More of your code here</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ______</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Hint: I recommend first writing non-function code to scrape the dataset, then figuring out how to incorporate your code into the function.</em></p>
<p>Include the following code to show your function works:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scrape_month_temp(month <span class="op">=</span> <span class="st">"january"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-2.3-20-points" class="level4">
<h4 class="anchored" data-anchor-id="question-2.3-20-points">Question 2.3 [20 points]</h4>
<p>I am looking for a trail that is:</p>
<ul>
<li><p>1000-3000 meters of elevation (I like mountains, but not too big.)</p></li>
<li><p>Rated at least a 4.5 on average</p></li>
<li><p>A loop trail (I don’t like to retrace my steps)</p></li>
<li><p>Not too cold in the summer, even at the peak</p></li>
</ul>
<ol type="a">
<li><p>Use your <code>recommend_trails</code> function to find me a few good options.</p></li>
<li><p>Use your second function (<code>scrape_temps</code>) to gather information on temperatures for the summer months (i.e.&nbsp;May, June, July, August) in the states for these trails.</p></li>
<li><p>Merge these two datasets, so I can see all the recommended trails alongside their summer temps. If you were unable to scrape the information from the website, then feel free to import the <code>temp_data.csv</code> file and use average temperatures instead of summer temperatures to complete this question.</p></li>
<li><p>Convert the temperatures of the states to be the temperatures at the peak elevation of my recommended hikes. <em>The temperature decreases by about 5.4 degrees Fahrenheit (or 9.8 degrees Celsius) for every 1000 feet you go up in elevation</em></p></li>
</ol>
<p><em>Note: In this question, many points will be deducted for copy-pasting similar code many times, and a small penalty will be deducted for use of a <code>for</code> loop.</em></p>
</section>
</section>
<section id="interview-questions" class="level2">
<h2 class="anchored" data-anchor-id="interview-questions">“Interview” Questions</h2>
<p>The 2024 Exam will also include some questions about python programming and data wrangling in general, that do not relate to the given dataset. These are meant to mimic the style of questions you might see in an interview for an analytics position.</p>
<section id="example-question" class="level3">
<h3 class="anchored" data-anchor-id="example-question">Example question</h3>
<p>The <code>pandas</code> library introduces a new data structure, the <code>data frame</code>. How is this different than basic python object structures, and what are the advantages of the <code>data frame</code> structure over these?</p>
</section>
<section id="example-answer" class="level3">
<h3 class="anchored" data-anchor-id="example-answer">Example answer</h3>
<p>A data frame is two-dimensional, like a matrix or array. However, unlike those, it allows the columns to be different data types from each other.</p>
<p>Some advantages are:</p>
<ul>
<li><p>We can store datasets, which often contain many different variable types, all in one object.</p></li>
<li><p>We can give the columns and rows names to reference them by.</p></li>
<li><p>We can use many built-in methods in <code>pandas</code> that are designed to do data manipulation on data frames.</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>